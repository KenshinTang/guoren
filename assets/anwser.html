<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>问答详情</title>
		<meta content="width=device-width,initial-scale=1.0,user-scalable=no" name="viewport">
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="format-detection" content="telephone=no,email=no,adress=no" />
		<link rel="stylesheet" href="css/g.css" />
		<link rel="stylesheet" href="css/comm.css" />
		<link rel="stylesheet" href="css/side.css" />
		<link rel="stylesheet" href="./inc/mescroll/mescroll.min.css" />
		<link rel="stylesheet" href="./inc/mescroll/swiper.min.css">
		<link rel="stylesheet" href="css/tpl.css" />
		<link rel="stylesheet" href="css/photo.css" />
		<style>
			header {
				border-bottom: 1px solid #f4f4f4;
			}
			
			span {
				vertical-align: bottom;
			}
			
			section {
				position: fixed;
				background: #f4f4f4;
			}
			
			.father {}
			
			.item {
				padding: 15px;
				display: flex;
				justify-content: space-between;
				background: #fff;
				border-bottom: 1px solid #f4f4f4;
			}
			
			.item>.l {
				display: flex;
				width: 100%;
			}
			
			.item>.l .img {
				width: 36px;
				height: 36px;
				border: 1px solid #f4f4f4;
				border-radius: 36px;
				margin-right: 12px;
				flex-basis: 36px;
			}
			
			.item>.r {
				text-align: right;
				display: flex;
				flex-direction: column;
				justify-content: space-between;
			}
			
			.main {
				/*margin-top: 10px;*/
			}
			
			.footer1 {
				justify-content: space-between;
				padding: 10px 0px 10px 15px;
				background: #fff;
				text-align: center;
				align-items: center;
			}
			
			.txt-div {
				width: 120px;
				height: 36px;
				border: 1px solid #f4f4f4;
				border-radius: 18px;
				line-height: 36px;
				color: #999999;
				text-align: left;
				background: url('./img/xie.png')no-repeat center;
				background-position-x: 10px;
				background-size: 12%;
				padding-left: 40px;
			}
			
			#textarea {
				display: block;
				margin: 0 auto;
				overflow: hidden;
				width: 100%;
				font-size: 14px;
				height: auto;
				/*line-height: 28px;*/
				padding: 2px;
				max-height: 200px;
				overflow-y: scroll;
				outline: 0 none;
				border: none;
				-webkit-user-select: text;
			}
			
			#textarea:empty:before {
				content: attr(placeholder);
				color: #999;
			}
			
			.footer2 {
				padding: 5px 15px;
				background: #fff;
			}
			
			textarea {}
			
			.footer2 .bottom {
				display: flex;
				justify-content: space-between;
				align-items: center;
				border: none;
				margin-top: 5px;
			}
			
			.footer2 .bottom .l {
				width: 23px;
				height: 23px;
				background: url('./img/pinglun/xl.png')no-repeat center;
				background-size: 100%;
			}
			
			.footer2 .bottom .r,
			.footer2 .bottom .ll {
				color: #fff;
				background: #098E75;
				padding: 5px 15px;
				border-radius: 5px;
			}
			
			.bgxq {
				background: url(img/index/bgxq.png) no-repeat 0px center;
				background-size: 16px;
				text-align: left;
				padding: 10px 0 10px 50px;
				color: #444444;
				/* border-bottom: 1px solid #f4f4f4; */
			}
			
			.jb {
				background: url(img/index/jb.png) no-repeat 0px center;
				background-size: 16px;
				text-align: left;
				padding: 10px 0 10px 50px;
				color: #444444;
			}
			
			#sinbox1 {
				position: absolute;
				bottom: 0;
				left: 5%;
				width: 90%;
			}
			
			.pl {
				background: url(img/xzd.png) no-repeat 0px center;
				background-size: 16px;
				text-align: left;
				padding: 10px 0 10px 50px;
				color: #444444;
			}
			
			#sinbox {
				background-color: #fff;
				padding: 10px 20px;
				position: absolute;
				bottom: 0;
				left: 0;
				width: 100%;
			}
			
			#consd {
				min-height: 50px;
			}
			
			#consd div,
			#consd img {
				width: 100%;
			}
			
			.cunbtn {
				display: inline-block;
				font-size: 12px;
				color: #098E75;
				border: 1px solid #098E75;
				padding: 0px 3px;
				border-radius: 3px;
				margin-left: 5px;
				font-weight: 200;
			}
			
			#pp {
				position: fixed;
				bottom: -100px;
				left: 10px;
				height: 1px;
				width: 1px;
			}
			
			.wimg {
				margin: 10px 0;
			}
			
			.addHave span,
			.addHave div {
				color: #464646;
			}
			
			div {
				word-break: normal;
			}
			
			.ddContent,
			.ddContent div {
				font-size: 16px;
			}
			
			.tiwen {
				width: 40px;
				height: 16px;
				margin-left: 8px;
				margin-top: -2px;
			}
		</style>
	</head>

	<body>
		<!-- 头部 -->
		<header>
			<div class="navBar" style="padding: 0;box-shadow: none;">
				<div class="navBackIcon" onclick="Comm.close()"></div>
				<div class="navItemIcon marl5 marr20" onclick="Comm.showWindow('sinboxTemp2',true);"></div>
				<div class="navTitle">回答详情</div>
			</div>
		</header>
		<section class="mescroll" id="box" style="position: fixed;">
			<input id="pp" type="text" />
			<div class="bg_white" id="head">
				<div class="schoolMsg" style="border: 0px;">
					<div class="color333  bold addHave f24 lh30" style="font-family: Arial;" id="newsTitle"></div>
					<div class="data mart15" id="goGeren">
						<img class="img fl" id="face" src="img/my/topxiang.png" style="border-radius: 30px;display: none;" width="40" height="40" />
						<div class="fl lh20 marl10" id="name">
						</div>
						<div class="clearfix"></div>
					</div>
					<div class="color505 mart15 addHave f16 ddContent" style="font-family: Arial;" id="newsContent"></div>
				</div>
				<div class="paddb10 paddl10 paddr10" style="border-bottom: 10px solid #f4f4f4;">
					<div class="fl" style="width: 40%;padding-left: 3px; color: #9B9B9B;" id="anster" onclick="model.anwserqz()">
						<img src="img/index/xie.png" width="20" class="fl marr10" />
						<div class="cgreen" style="margin-top: 1px;">我要回答</div>
						<div class="clearfix"></div>
					</div>
					<div class="mrpx cgreen fr lookAll paddr10" style="margin-top: 1px;" onclick="model.all();">

					</div>
					<div class="clearfix"></div>
				</div>
			</div>
			<div id="top">

			</div>
			<div class="main">
				<p class="bold" style="padding:10px;padding-left: 13px;background: #fff;font-size: 14px;" id="commentNumber"></p>
				<div id="list">

				</div>
			</div>
		</section>
		<footer class="">
			<div class="footer2 hide">
				<p style="color:#ccc;" id="customerName">正在回复Enzo</p>
				<div contenteditable="plaintext-only" onpaste="model.copy()" oninput="editOninput(this)" onkeydown="zhuanfa.keydown(this)" id="textarea" placeholder="观点的碰撞，思想的火花"></div>
				<div class="bottom">
					<div></div>
					<div class="r jjs" id="Release" onclick="model.release()">发布</div>
				</div>
			</div>
			<div id="bar" class="footer1">

			</div>
		</footer>
		<div id="sinbox" wtd="sinboxTemp2">
			<div class="dflex" style="border-bottom: #f4f4f4 1px solid;">
				<div class="mart20 marb20" onclick="model.shear(1)">
					<img src="img/index/wx.png" width="45" />
					<p class="c9e mart10">微信好友</p>
				</div>
				<div class="mart20 marb20" onclick="model.shear(2)">
					<img src="img/index/pyq.png" width="45" />
					<p class="c9e mart10">朋友圈</p>
				</div>
				<div class="mart20 marb20" onclick="model.shear(3)">
					<img src="img/index/qq.png" width="45" />
					<p class="c9e mart10">QQ</p>
				</div>
				<div class="mart20 marb20" onclick="model.shear(4)">
					<img src="img/index/qqkj.png" width="45" />
					<p class="c9e mart10">QQ空间</p>
				</div>
				<div class="mart20 marb20" onclick="model.shear(5)">
					<img src="img/index/wb.png" width="45" />
					<p class="c9e mart10">微博</p>
				</div>
			</div>
			<div class="paddt10 paddb10 color666" style="border-top:#f4f4f4 1px solid;" onclick="Comm.showWindow('')">
				取消
			</div>
		</div>
	</body>

	<script id="footTpl" type="text/html">
		<div class="scl-but mart5 paddb5 ">
			<input class="txt-div wordWrap" readonly="readonly" id="txt-div" onfocus="model.showReviews()" placeholder="写回复..." /> {{if($data[0].isPraise==1)}}
			<div onclick="model.removePraise({{$data[0].commentId}},this)" style="width:60px">
				<img src="img/index/zand.png" id="zan" height="20" />
				<span style="margin-left: 1px;display: inline-block;width: 25px;" class="c9e f12 zan tleft wordW">{{conunm($data[0].praiseNumber)}}</span>
				<p class="c9e f12" style="text-align: left;padding-left: 12px;">点赞</p>
			</div>
			{{else}}
			<div onclick="model.addPraise({{$data[0].commentId}},this)" style="width:60px">
				<img src="img/index/zan.png" id="zan" height="20" />
				<span style="margin-left: 1px;display: inline-block;width: 25px;" class="c9e f12 zan tleft wordW">{{conunm($data[0].praiseNumber)}}</span>
				<p class="c9e f12" style="text-align: left;padding-left: 12px;">点赞</p>
			</div>
			{{/if}} {{if $data[0].isTrample == 1}}
			<div onclick="model.removeTrample({{$data[0].commentId}},this)" style="width:60px">
				<img src="img/index/caid.png" id="cai" height="20" />
				<p class="c9e f12">踩</p>
			</div> {{else}}
			<div onclick="model.addTrample({{$data[0].commentId}},this)" style="width:60px">
				<img src="img/index/cai.png" id="cai" height="20" />
				<p class="c9e f12 center">踩</p>
			</div> {{/if}}
			<!--{{if isLike == 1}}
			<div onclick="model.romeveLike({{commentId}},this)" class="center">
				<img src="img/index/xind.png" height="20" />
				<p class="c9e f12 center">喜欢</p>
			</div> {{else}}
			<div onclick="model.addLike({{commentId}},this)" class="center">
				<img src="img/index/xin.png" height="20" />
				<p class="c9e f12 center">喜欢</p>
			</div> {{/if}}-->
			{{if $data[0].isCollection ==1}}
			<div onclick="model.removeCollection({{$data[0].commentId}},this)" class="center" style="width:60px">
				<img src="img/index/shoud.png" height="20" />
				<p class="c9e f12 center">收藏</p>
			</div> {{else}}
			<div onclick="model.addCollection({{$data[0].commentId}},this)" class="center" style="width:60px">
				<img src="img/index/shou.png" height="20" />
				<p class="c9e f12 center">收藏</p>
			</div> {{/if}}
		</div>
	</script>
	<script type="text/html" id="demo">
		{{each $data[0].oneList as item index}}
		<div class="item" id="{{item.commentId}}">
			<img onclick="{{if item.userType==1}}Comm.go('personal.html?customerId={{item.customerId}}'){{else if item.userType==2}}Comm.go('University.html?schoolId={{item.customerId}}' ){{else if item.userType==3}}Comm.go('major.html?majorId={{item.customerId}}'){{/if}}" src="{{OSS(item.face,'s')}}" class="fl" width="36" height="36" style="border-radius:50%;">
			<div class="fr r f14 marl15" style="width: 90%;">
				<div class="">
					<!--onclick="{{if item.userType==1}}Comm.go('personal.html?customerId={{item.customerId}}'){{else if item.userType==2}}Comm.go('University.html?schoolId={{item.customerId}}' ){{else if item.userType==3}}Comm.go('major.html?majorId={{item.customerId}}'){{/if}}"-->
					<span class="fl bold wordW">
				{{item.customerName}}	
                </span> {{if item.customerId==$data[0].publishCustomerId}}<span class="fl"><img class="tiwen" src="img/index/tiwenzhe.png"/></span>{{/if}}
					<div class="fr paddb5 paddr5" onclick="model.More({{item.commentId}},'{{item.customerName}}',{{item.customerId}},{{$data[0].publishCustomerId}},{{item.commentId}})">
						<img src="img/index/more.png" width="15" />
					</div>
					{{if(item.isPraise==0)}}
					<span class="c9e marl5 fr wordW" style="display: inline-block;width: 25px;text-align: left;" id="zan{{item.commentId}}">{{item.praiseNumber}}</span>
					<img onclick="model.praiseByCommentId(this,{{item.commentId}})" data-isPraise="0" src="img/index/zan.png" class="fr" width="19" height="17"> {{else}}
					<span class="c9e marl5 fr wordW" style="display: inline-block;width: 25px;text-align: left;" id="zan{{item.commentId}}">{{item.praiseNumber}}</span>
					<img onclick="model.praiseByCommentId(this,{{item.commentId}})" data-isPraise="1" src="img/index/zand.png" class="fr" width="19" height="17"> {{/if}}
				</div>
				<div onclick="model.setu({{item.commentId}},'{{item.customerName}}',{{item.customerId}},{{item.commentId}})">
					<div class="mart5 paddr20 addHave" style="text-align:left;">{{item.content}}</div>
					<div class="mart10 f12 paddr10">
						<span class="fl f12" style="color:#8D8D8D;">{{sldate(item.addTime)}} </span>

					</div>
				</div>
				{{if item.twoList.length>0}} {{each item.twoList v k}} {{if k
				<2}} <div class="children bordert mart15" id="{{v.commentId}}">
					<!--<img onclick="model.geren({{v.customerId}},0)" src="{{OSS(v.face)}}" class="fl" width="20" height="20" style="border-radius:50%;">-->
					<div class="f14 r">
						<div>
							{{if v.isThree}}
							<div class="mart15 paddr20 " style="text-align:left;line-height: 22px;" onclick="model.setu({{v.commentId}},'{{v.customerName}}',{{v.customerId}},{{item.commentId}})">
								<img src="{{OSS(v.face,'s')}}" width="22" height="22" style="border-radius: 50%;margin-right: 4px;" />
								<span style="color: #098E75;" onclick="Comm.go('personal.html?customerId={{v.customerId}}');event.stopPropagation()">{{v.customerName}}</span>{{if v.customerId==$data[0].publishCustomerId}}<span><img class="tiwen" src="img/index/tiwenzhe.png"/></span>{{/if}}
								<span> 回复</span>
								<span style="color:#098E75;" onclick="Comm.go('personal.html?customerId={{v.customerId2}}')">@{{v.customerName2}}{{if v.customerId2==$data[0].publishCustomerId}}<span style="vertical-align: initial;"><img class="tiwen" src="img/index/tiwenzhe.png"/></span>{{/if}}</span>

								<span class="addHave">:{{v.content}}</span>
							</div>
							{{else}}
							<div onclick="model.setu({{v.commentId}},'{{v.customerName}}',{{v.customerId}},{{item.commentId}})" class="mart15 paddr20 " style="text-align:left;line-height: 22px;">
								<img src="{{OSS(v.face,'s')}}" width="22" height="22" style="border-radius: 50%;margin-right: 4px;" />
								<span style="color: #098E75;" onclick="Comm.go('personal.html?customerId={{v.customerId}}');event.stopPropagation()">{{v.customerName}}</span>{{if v.customerId==$data[0].publishCustomerId}}<span><img class="tiwen" src="img/index/tiwenzhe.png"/></span>{{/if}}

								<span class="addHave">：{{v.content}}</span>
							</div>
							{{/if}}

							<div class="mart5">
								<p class="fl f12" style="color:#8D8D8D;">{{sldate(v.addTime)}}</p>
								<div class="fr paddb5 paddl20 paddr5" onclick="model.More({{v.commentId}},'{{v.customerName}}',{{v.customerId}},{{$data[0].publishCustomerId}},{{item.commentId}})">
									<img src="img/index/more.png" width="15" />
								</div>
								{{if(v.isPraise==0)}}
								<span class="c9e fr marl5" id="zan{{v.commentId}}">{{v.praiseNumber}}</span>
								<img onclick="model.praiseByCommentId(this,{{v.commentId}})" data-isPraise="0" src="img/index/zan.png" class="fr" width="19" height="17"> {{else}}
								<span class="c9e fr marl5" id="zan{{v.commentId}}">{{v.praiseNumber}}</span>
								<img onclick="model.praiseByCommentId(this,{{v.commentId}})" data-isPraise="1" src="img/index/zand.png" class="fr" width="19" height="17"> {{/if}}
							</div>
						</div>
						<div class="clearfix"></div>

					</div>
			</div>
			{{/if}} {{/each}} {{/if}} {{if item.twoList.length>2}}
			<div class="pad10 center" style="color:#098E75;" onclick="Comm.go('moreAnwser.html?newsId={{$data[0].newsId}}&commentId={{item.commentId}}&tw={{$data[0].customerId}}')">
				查看更多{{item.commentNumber-2}}条回复>>
			</div>
			{{/if}}
		</div>
		<div class="clearfix"></div>
		</div> {{/each}}
		<!--{{if $data[0].oneList.length>2}}
			<p class="pad10 center mart10 cgreen" onclick="Comm.go('moreAnwser.html?newsId={{$data[0].newsId}}&commentId={{$data[0].commentId}}')">查看更多{{$data[0].oneSize-2}}条回复>></p>
			{{/if}}-->
	</script>

	<script type="text/html" id="demo1">
		<div class="item">
			<div class="l">

				<div class="data" style="width: 100%;">
					<img class="img fl" src="{{OSS($data[0].face,'s')}}" onclick="Comm.go('personal.html?customerId={{$data[0].customerId}}')" />
					<div class="fl" style="width: 84%;">
						<p class="bold">
							<span>{{$data[0].customerName}}</span> {{if $data[0].isBestComment==1}}<span style="display: inline-block;"><img src="img/index/zuiyouhuida.png" width="50" height="16" style="margin-left: 5px;margin-top: -2px;" /></span>{{/if}}
							<span onclick="model.More({{$data[0].commentId}},'{{$data[0].customerName}}',{{$data[0].customerId}},{{$data[0].publishCustomerId}},'',1)" class="fr paddl5"><img src="img/index/more.png" width="14" height="3"></span>
						</p>
						<p class="f12" style="color:#8D8D8D;">{{sldate($data[0].addTime)}}</p>
					</div>
					<div class="clearfix"></div>
					<div class="mart10 marb10 wimgbox addHave lh21_5" id="consd" style="color:#464646; font-family: Arial;">{{$data[0].fullContent}} </div>

				</div>
			</div>
		</div>
	</script>
	<div id="sinbox1" class="paddb10" wtd="sinboxTemp">
		<div class="bg_white marb10 f16" style="border-radius: 10px;">
			<div class="coloreb3 paddb15 paddt15" onclick="Comm.showWindow('');model.shanping()">删除</div>
		</div>
		<div class="bg_white paddt15 paddb15 f16 color666" style="border-radius: 10px;" onclick="Comm.showWindow('')">取消</div>
	</div>
	<div id="sinbox1" class="paddb10" wtd="sinboxTemp1">
		<div class="bg_white marb10 f16" style="border-radius: 10px;">
			<div class="paddt15 paddb15" onclick="model.Reply()">回复</div>
			<div class="paddt15 paddb15" style="border-top: 1px solid #EBEBEB;" onclick="model.Report()">举报</div>
		</div>
		<div class="bg_white paddt15 paddb15 f16 color666" style="border-radius: 10px;" onclick="Comm.showWindow('')">取消</div>
	</div>
	<div id="sinbox1" class="paddb10" wtd="sinboxTemp3">
		<div class="bg_white marb10 f16" style="border-radius: 10px;">
			<div class="paddt15 paddb15" onclick="model.Reply()">回复</div>
			<div class="paddt15 paddb15 coloreb3" style="border-top: 1px solid #EBEBEB;" onclick="Comm.showWindow('');model.shanping()">删除</div>
		</div>
		<div class="bg_white paddt15 paddb15 f16 color666" style="border-radius: 10px;" onclick="Comm.showWindow()">取消</div>
	</div>
	<script type="text/javascript" src="inc/z.js"></script>
	<script type="text/javascript" src="inc/g.js"></script>
	<script type="text/javascript" src="inc/comm.js"></script>
	<script type="text/javascript" src="inc/side.js"></script>
	<script type="text/javascript" src="inc/mescroll/mescroll.min.js"></script>
	<script type="text/javascript" src="./inc/mescroll/swiper.min.js"></script>
	<script type="text/javascript" src="inc/art-template.js"></script>
	<script type="text/javascript" src="inc/refresh.js" charset="utf-8"></script>
	<script type="text/javascript" src="inc/photo.js"></script>
	<script type="text/javascript" src="inc/tpl.js"></script>
	<script type="text/javascript" src="inc/dict.js"></script>

	<script>
		var customerId = app.getCid();
		var commentId = Comm.query('commentId'); //主回复id
		var newsId = Comm.query('newsId');
		var merefresh = null;
		var data = [];
		var shearId = newsId;
		var shearTitle = '发现一个问题哟~';
		var shearContent = '快来帮我还回答吧~';
		var yId = '';
		var yanme = '';
		var pinNum = '';
		var mid = ''; //回复id
		var fids = ''
		var customerName = ''; //主回复名字
		var customerName2 = '';
		var fid = '';
		var isCheck = true;

		function pageload() {
			zhuanfa.suiji('textarea', 'plksj');
			myrefresh();
			Comm.db('anwserId', commentId);
		}

		function editOninput(a) {
			//输入控制
			zhuanfa.oninput(a);
			Comm.db('zhuanfa', '1')
			//数字回写，没有数字限制不需要
			//$('#num').html(zhuanfa.getlen(a));
		}

		function androidback() {
			if(parseInt(Comm._pageinfo.android_home) === 0) {
				if($('.footer2').hasClass('hide')) {
					Comm.close();
				} else {
					model.loseBlur();
					Comm.bg(false);
					Comm.resizeSection();
				}

			} else {
				if(parseInt(Comm._pageinfo.android_home) === 1) {
					Comm._pageinfo.android_home = 2;
					Comm.confirm("您确定要退出应用？", function(a) {
						if(a == 1) Comm.close();
						else Comm._pageinfo.android_home = 1;
					});
				}
			}
		}

		function pageresume() {
			if(Comm.db('zhuanfa') == 1) {
				zhuanfa.pageresume(Comm.g('textarea'));
				Comm.db('zhuanfa', '9');

			} else {
				//model.gteNweInfo();
			}
			if(!Comm.db('qzTitle')) {

				Comm.db('qzTitle', '');
			}

		}

		function myrefresh() {
			if(merefresh == null) {
				merefresh = new MERefresh('box,list', {
					refreshUrl: '/api/news/commentListByCommentId',
					refreshTypeGet: true
				});
				//网络请求参数
				merefresh.refreshOption.refreshParm = {
					customerId: customerId,
					commentId: commentId,
					commentType: 1
				};
				//页面 <刷新> 的回调
				merefresh.refreshOption.refresh_cb = function(refresh, d) {
					refresh.successEndRef(d.data && d.data[0].oneList ? d.data[0].oneList.length : 0, d.totalCount);
					model.gteNweInfo();
					//渲染主回复
					d.data[0].fullContent = d.data[0].fullContent.replace(/<div>|<\/div>/gi, "").replace(/<script/g, '').replace(/(\r\n|\n|\r)/gm, "<br/>").replace(/[ ]/g, "&nbsp;").replace(/&nbsp;src/g, " src");
					$('#top').html(template('demo1', d.data));
					pinNum = d.data[0].praiseNumber;

					$('#commentNumber').html('回复');

					//渲染副回复
					$('footer #bar').html(template('footTpl', d.data));
					Comm.resizeSection();

					//渲染副回复
					data.customerName = d.data[0].customerName;
					customerName = d.data[0].customerName;
					mid = d.data[0].commentId;
					yname = d.data[0].customerName;
					yId = d.data[0].commentId;
					d.data.fid = fid;
					refresh.appendHtml(template('demo', d.data));
					data = d.data[0]
					shearContent = d.data[0].content.replace(/<\/?[^>]*>/gim, "");
					if(Comm.query('cont') == 1) {
						setTimeout(function() {
							var howFar = $('#head').height() + $('#top').height();
							$('section').scrollTop(howFar, 1)
						}, 100)
					}
					$('#consd img').each(function(i, e) {
						$(e).addClass('wimg')
						e.onclick = function() {
							Photo.show(this, true);
						}
						e.setAttribute('rsrc', e.src);
					})
					$('.addHave').children().addClass('havemenu');
					$('.addHave').addClass('havemenu');
				};
			} else {

				merefresh.refreshOption.refreshParm = {
					customerId: customerId,
					commentId: commentId,
					commentType: 1
				};
				//重置列表数据
				merefresh.MeRefScroll.resetUpScroll(true);
				//model.mere.MeRefScroll.triggerDownScroll();
				//隐藏回到顶部按钮
				merefresh.MeRefScroll.hideTopBtn();
			}

		}

		function Focus(id) {
			// 始终聚焦在文本末尾
			el = document.getElementById(id);
			//el=el[0];  //jquery 对象转dom对象
			el.focus();
			if($.support.msie) {
				var range = document.selection.createRange();
				this.last = range;
				range.moveToElementText(el);
				range.select();
				document.selection.empty(); //取消选中
			} else {
				var range = document.createRange();
				range.selectNodeContents(el);
				range.collapse(false);
				var sel = window.getSelection();
				sel.removeAllRanges();
				sel.addRange(range);
			}
		}
		var model = {
			txt: '', //回复的内容
			type: 1,
			fist: 0,
			//获取详情
			gteNweInfo: function() {
				AJAX.GET("/api/news/info?newsId=" + newsId, function(d) {
					if(d.code == 1) {
						fid = d.data.itemId;
						model.title = d.data.news.title;
						$('#newsTitle').html(d.data.news.title.replace(/<div>|<\/div>/gi, "").replace(/(\r\n|\n|\r)/gm, "<br/>").replace(/[ ]/g, "&nbsp;").replace(/&nbsp;src/g, " src"))
						$('#newsContent').html(d.data.news.content.replace(/<div>|<\/div>/gi, "").replace(/<script/g, '').replace(/(\r\n|\n|\r)/gm, "<br/>").replace(/[ ]/g, "&nbsp;").replace(/&nbsp;src/g, " src"));
						$('#face').attr('src', Comm.OSS.getImgUrl(d.data.itemFace, 's'));
						$('#face').show()
						$('#face').attr('onclick', "Comm.go('personal.html?customerId=" + d.data.itemId + "')");
						$('#name').html('<span class="bold">' + d.data.itemName + '</span>' + '<br><span class="color999 f12">' + sldate(d.data.news.addTime) + '</span>')
						//						<span class="cunbtn">提问者</span>

						$('.lookAll').html('查看全部' + d.data.news.commentNumber + '条回答>>')
						if(Comm.db('userinfo') && Comm.db('userinfo').customerName) {
							shearTitle = Comm.db('userinfo').customerName + '给您分享了一个回答';
						}

					} else {
						Comm.alert(d.msg, function() {
							Comm.close();
						})
					}
				})
			},
			anwserqz: function() {
				if(app.isLogin() == false) {
					Comm.showWindow('')
					top.Comm.confirm('您还未登录,请先登录', function(a) {
						if(a == 1) {
							Comm.go('newLogin.html')
						}
					});
					return false;
				}
				if(Comm.db('userinfo').shutup==1){
					Comm.alert('您暂无权限~',function(){
							
					});
					return false;
					}
				Comm.db('qzTitle', model.title);
				Comm.go('anwserqz.html?newsId=' + newsId + '&clo=1&disable=1')

			},
			setu: function(v, name, sid, fid) {
				mid = v;
				customerName2 = name;
				data.customerName = name;
				model.Reply();
				fids = fid;
			},
			geren: function(id, type) {
				event.stopPropagation();
				if(type == 0) {
					Comm.go('personal.html?customerId=' + id);
				} else if(type == 1) {
					Comm.go('University.html?schoolId=' + id);
				} else if(type == 2) {
					Comm.go('major.html?majorId=' + id);
				} else if(type == 4) {
					Comm.go('postDetails.html?groupId=' + id);
				}
			},
			all: function() {
				Comm.go("qzAskDetail.html?newsId=" + newsId)
			},
			//点击回复的更多选项
			More: function(v, name, sid, pid, fcid, fist) {
				mid = v;
				fids = fcid;
				customerName2 = name;
				data.customerName = name;
				model.fist = fist;
				console.log(pid)
				//          if(pid==customerId){
				//          	Comm.showWindow('sinboxTemp3', true);
				//              $('footer').css('z-index', 999);
				//          }else{

				if(sid == customerId) {
					Comm.showWindow('sinboxTemp', true);
					$('footer').css('z-index', 999);
				} else {
					Comm.showWindow('sinboxTemp1', true)
					$('footer').css('z-index', 999);
				}
				//          }

			},
			shanping: function() {
				Comm.showWindow('');
				Comm.confirm('确认删除这条回复？', function(d) {
					if(d) {
						AJAX.GET('/admin/comment/noenable?commentId=' + mid, function(a) {
							if(a && a.code == 1) {
								Comm.message('删除成功');
								//myrefresh();
								if(model.fist == 1) {
									Comm.close();
								} else {
									$('#' + mid).remove();
								}

							} else {
								Comm.message(a.msg);
							}
						})
					}
				})
			},
			//给回复点赞
			praiseByCommentId: function(e, commentId) {
				var isPraise = $(e).attr('data-isPraise'); //是否点赞了
				//没点赞
				if(isPraise == 0) {
					AJAX.POST('/api/news/praiseByCommentId', {
						commentId: commentId
					}, function(d) {
						if(d.code == 1) {
							var num = $('#zan' + commentId).html();
							num++;
							$('#zan' + commentId).html(num);
							$(e).attr('src', 'img/index/zand.png').attr('data-isPraise', '1');
							$(e).addClass('donghua')
						} else {
							Comm.message(d.msg)
						}
					})
					return;
				}
				//点赞了
				if(isPraise == 1) {
					AJAX.POST('/api/news/cancelPraiseByCommentId', {
						commentId: commentId,
						commentId: commentId
					}, function(d) {
						if(d.code == 1) {
							var num = $('#zan' + commentId).html();
							num--;
							$('#zan' + commentId).html(num);
							$(e).attr('src', 'img/index/zan.png').attr('data-isPraise', '0');
							$(e).removeClass('donghua')
						} else {
							Comm.message(d.msg)
						}
					})
				}

			},
			addPraise: function(id, e) { //点赞
				if(isCheck == true) {
					isCheck = false
					AJAX.GET('/api/news/praiseByCommentId?commentId=' + id, function(a) {
						if(a && a.code == 1) {
							isCheck = true;
							//Comm.message('点赞成功');
							$(e).attr('onclick', 'model.removePraise(' + id + ',this)');
							var num = $('.zan').html();
							$('.zan').html(a.data);
							var aa = $(e).children();
							$(aa[0]).attr('src', 'img/index/zand.png');
							$('#cai').attr('src', 'img/index/cai.png');
							$('#cai').parent().attr('onclick', 'model.addTrample(' + id + ',this)')
							$(e).addClass('donghua')
						} else {
							Comm.message(a.msg);
						}
					})
				} else {
					if(app.isLogin() == false) {
						Comm.showWindow('')
						top.Comm.confirm('您还未登录,请先登录', function(a) {
							if(a == 1) {
								Comm.go('newLogin.html')
							}
						});
						return false;
					}
				}

			},
			addLike: function(id, e) { //喜欢

				AJAX.GET('/api/comment/addLike?commentId=' + id, function(a) {
					if(a && a.code == 1) {
						$(e).attr('onclick', 'model.romeveLike(' + id + ',this)');
						var aa = $(e).children();
						$(aa[0]).attr('src', 'img/index/xind.png');

					} else {
						Comm.message(a.msg);
					}
				})
			},
			addCollection: function(id, e) { //收藏
				if(isCheck == true) {
					isCheck = false;
					AJAX.GET('/api/collection/collect?itemId=' + id + '&customerId=' + app.getCid() + '&itemType=2', function(a) {
						if(a && a.code == 1) {
							isCheck = true;
							$(e).attr('onclick', 'model.removeCollection(' + id + ',this)');
							var aa = $(e).children();
							$(aa[0]).attr('src', 'img/index/shoud.png');
							$(e).addClass('donghua')
						} else {
							Comm.message(a.msg);
						}
					})
				} else {
					if(app.isLogin() == false) {
						Comm.showWindow('')
						top.Comm.confirm('您还未登录,请先登录', function(a) {
							if(a == 1) {
								Comm.go('newLogin.html')
							}
						});
						return false;
					}
				}

			},
			addTrample: function(id, e) { //踩
				if(isCheck == true) {
					isCheck = false;
					AJAX.GET('/api/comment/addTrample?commentId=' + id, function(a) {
						isCheck = true;
						if(a && a.code == 1) {
							$(e).attr('onclick', 'model.removeTrample(' + id + ',this)');
							var aa = $(e).children();
							$(aa[0]).attr('src', 'img/index/caid.png');
							$('#zan').attr('src', 'img/index/zan.png');
							//                      var num = $('.zan').html();
							//                      if (num != 0 && num > pinNum) {
							$('.zan').html(a.data);
							//                      }
							$('#zan').parent().attr('onclick', 'model.addPraise(' + id + ',this)')
						} else {
							Comm.message(a.msg);
						}
					})
				} else {
					if(app.isLogin() == false) {
						Comm.showWindow('')
						top.Comm.confirm('您还未登录,请先登录', function(a) {
							if(a == 1) {
								Comm.go('newLogin.html')
							}
						});
						return false;
					}
				}

			},
			removePraise: function(id, e) { //取消点赞
				if(isCheck == true) {
					isCheck = false;
					AJAX.GET('/api/news/cancelPraiseByCommentId?commentId=' + id, function(a) {
						if(a && a.code == 1) {
							isCheck = true;
							$(e).attr('onclick', 'model.addPraise(' + id + ',this)');
							var aa = $(e).children();
							var num = $('.zan').html();
							$('.zan').html(a.data);
							$(aa[0]).attr('src', 'img/index/zan.png');
							$(e).removeClass('donghua')
						} else {
							Comm.message(a.msg);
						}
					})
				} else {
					if(app.isLogin() == false) {
						Comm.showWindow('')
						top.Comm.confirm('您还未登录,请先登录', function(a) {
							if(a == 1) {
								Comm.go('newLogin.html')
							}
						});
						return false;
					}
				}

			},
			romeveLike: function(id, e) { //取消喜欢
				AJAX.GET('/api/comment/cancelLike?commentId=' + id, function(a) {
					if(a && a.code == 1) {
						$(e).attr('onclick', 'model.addLike(' + id + ',this)');
						var aa = $(e).children();
						$(aa[0]).attr('src', 'img/index/xin.png');

					} else {
						Comm.message(a.msg);
					}
				})
			},
			removeCollection: function(id, e) { //取消收藏
				if(isCheck == true) {
					isCheck = false;
					AJAX.GET('/api/collection/deleteById?itemId=' + id + '&customerId=' + app.getCid() + '&itemType=2', function(a) {
						if(a && a.code == 1) {
							isCheck = true;
							$(e).attr('onclick', 'model.addCollection(' + id + ',this)');
							var aa = $(e).children();
							$(aa[0]).attr('src', 'img/index/shou.png');
							//myrefresh();
							$(e).removeClass('donghua')
						} else {
							Comm.message(a.msg);
						}
					})
				} else {
					if(app.isLogin() == false) {
						Comm.showWindow('')
						top.Comm.confirm('您还未登录,请先登录', function(a) {
							if(a == 1) {
								Comm.go('newLogin.html')
							}
						});
						return false;
					}
				}

			},
			removeTrample: function(id, e) { //取消踩
				if(isCheck == true) {
					isCheck = false;
					AJAX.GET('/api/comment/cancelTrample?commentId=' + id, function(a) {
						if(a && a.code == 1) {
							isCheck = true;
							$(e).attr('onclick', 'model.addTrample(' + id + ',this)');
							var aa = $(e).children();
							$(aa[0]).attr('src', 'img/index/cai.png');

						} else {
							Comm.message(a.msg);
						}
					})
				} else {
					if(app.isLogin() == false) {
						Comm.showWindow('')
						top.Comm.confirm('您还未登录,请先登录', function(a) {
							if(a == 1) {
								Comm.go('newLogin.html')
							}
						});
						return false;
					}
				}

			},
			//举报
			Report: function() {
				if(app.isLogin() == false) {
					Comm.showWindow('')
					top.Comm.confirm('您还未登录,请先登录', function(a) {
						if(a == 1) {

							Comm.go('newLogin.html')
						}
					});
					return false;
				}
				Comm.showWindow('')
				Comm.go('./report.html?itemType=2&itemId=' + mid)
			},
			//点击添加回复
			showReviews: function() {
				if(app.isLogin() == false) {
					Comm.showWindow('')
					document.activeElement.blur();
					top.Comm.confirm('您还未登录,请先登录', function(a) {
						if(a == 1) {
							Comm.go('newLogin.html')
						}
					});

					return false;
				}
				if(Comm.db('userinfo').shutup==1){
					Comm.alert('您暂无权限~',function(){
							
						})
					return false;
					}
				$('section').scrollTop($('.main').height() + 999)
				if(Comm.ios()) {
					document.body.addEventListener('touchmove', function(e) {
						if(document.activeElement)
							document.activeElement.blur();
					}, {
						passive: false
					});
					$('#pp').focus();
					this.type = 1;
					$('footer .footer2').removeClass('hide');
					$('footer .footer1').addClass('hide');
					$('footer').css('z-index', 9999);
					$('footer .footer2>p').html('正在回复：' + data.customerName);
					//输入框聚焦
					Comm.bg(true);
					$("#textarea").focus();
					Focus('textarea');
					Comm.g('MainBg').addEventListener("touchstart", function() {
						Comm.bg(false);
						model.loseBlur();
					}, false);

				} else {

					this.type = 1;
					$('footer .footer2').removeClass('hide');
					$('footer .footer1').addClass('hide');
					$('footer').css('z-index', 9999);
					//输入框聚焦
					Comm.bg(true);
					Comm.g('MainBg').addEventListener("touchstart", function() {
						Comm.bg(false);
						model.loseBlur();
					}, false);
					//					$('#textarea').html('');
					//Comm.resizeSection();
					$("#textarea").focus();
					Focus('textarea');
					console.log(data)
					$('footer .footer2>p').html('正在回复：' + data.customerName);
					Comm.resizeSection();
				}
				setInterval(function() {
					if($("#textarea").html().replace(/\s+/g, "").replace(/<\/?.+?>/g, "").replace(/ /g, "").replace(/[ ]|&nbsp;/g, '').length > 0) {
						$('.jjs').css('background', '#098E75');
						$('.jjs').attr('onclick', 'model.release()');
					} else {
						$('.jjs').css('background', '#f4f4f4');
						$('.jjs').attr('onclick', '');
					}
				}, 1)
				//$("#textarea").on("paste", function(e) {
				//				e.preventDefault();
				//				zhuanfa.copy = true;
				//			var text;
				//			var clp = (e.originalEvent || e).clipboardData;
				//			if(clp === undefined || clp === null) {
				//				text = window.clipboardData.getData("text") || "";
				//				if(text !== "") {
				//					if(window.getSelection) {
				//						var newNode = document.createElement("span");
				//						newNode.innerHTML = text;
				//						window.getSelection().getRangeAt(0).insertNode(newNode);
				//					} else {
				//						document.selection.createRange().pasteHTML(text);
				//					}
				//				}
				//			} else {
				//				text = clp.getData('text/plain') || "";
				//				if(text !== "") {
				//					text = text.replace(/<\/?.+?\/?>/g, "").replace(/<[^>]*>|<\/[^>]*>/gm, "");
				//					var div = document.createElement('div');
				//						div.innerHTML=text;
				//						document.execCommand('insertText', false, div.innerText);
				//						zhuanfa.copy = false;
				//				}
				//			}
				//			});
			},
			copy: function() {
				var e = event;
				e.preventDefault();
				zhuanfa.copy = true;
				var text;
				var clp = (e.originalEvent || e).clipboardData;
				if(clp === undefined || clp === null) {
					text = window.clipboardData.getData("text") || "";
					if(text !== "") {
						if(window.getSelection) {
							var newNode = document.createElement("span");
							newNode.innerHTML = text;
							window.getSelection().getRangeAt(0).insertNode(newNode);
						} else {
							document.selection.createRange().pasteHTML(text);
						}
					}
				} else {
					text = clp.getData('text/plain') || "";
					if(text !== "") {
						text = text.replace(/<\/?.+?\/?>/g, "").replace(/<[^>]*>|<\/[^>]*>/gm, "");
						var div = document.createElement('div');
						div.innerHTML = text;
						document.execCommand('insertText', false, div.innerText);

					}
				}
				zhuanfa.copy = false;
			},
			//输入框失去焦点
			loseBlur: function() {
				//				if(this.txt == '') {
				//隐藏回复框
				$("#textarea").blur();
				$('footer .footer1').removeClass('hide');
				$('footer .footer2').addClass('hide');
				data.customerName = yname;
				mid = yId;
				setTimeout(function() {
					Comm.resizeSection();
				}, 500)

				//				}
			},
			//输入框输入事件
			texInput: function() {
				this.txt = $('#textarea').html()
			},
			//点击发布
			release: function() {
				var that = this;
				var type = that.type;
				if($('#textarea').html().replace(/\s+/g, "").replace(/<\/?.+?>/g, "").replace(/ /g, "").replace(/[ ]|&nbsp;/g, '') == '') {
					Comm.message('请输入回复内容')
					return;
				}
				if($("#textarea").html().replace(/\s+/g, "").replace(/<\/?.+?>/g, "").replace(/ /g, "").replace(/[ ]|&nbsp;/g, '').length > 500) {
					Comm.message('回复内容最多输入500字，请重新编辑')
					return;
				}
				var o = {};
				if(this.type == 1) {
					o = {
						newsId: newsId,
						sid: commentId,
						content: '<span style="color:#464646;vertical-align: bottom;">' + $('#textarea').html().replace(/(\r\n|\n|\r)/gm, "<br/>") + '</span>',
						commentType: 1,
						ids: zhuanfa.ids.join(',')
					}
				}
				if(this.type == 2) {
					o = {
						newsId: newsId,
						sid: mid,
						content: '<span style="color:#464646">' + $('#textarea').html().replace(/(\r\n|\n|\r)/gm, "<br/>") + '</span>', //.replace(/(\r\n|\n|\r)/gm, "<br/>").replace(/<div>|<\/div>/gi, "").replace(/(?!.*>)\s/g, "&nbsp;")
						commentType: 1,
						ids: zhuanfa.ids.join(',')
					}
				}
				Comm.loading('发布中...');
				AJAX.POST('/admin/contentOfNo/saveComment', o, function(d) {

					Comm.loading(false);
					if(d && d.code == 1) {
						Comm.bg(false);
						Comm.message('回复成功');
						Comm.bg(false);
						that.txt = '';
						$('#textarea').html('');
						model.loseBlur();
						if(type == 2) {

							Comm.go('moreAnwser.html?newsId=' + newsId + '&commentId=' + fids + '&type=1&tw=' + fid);
						} else {
							myrefresh();
						}
						if(Comm.ios()) {
							resizeDom();
						} else {
							Comm.resizeSection();
						}

						//merefresh.refreshFunction()
					} else {
						Comm.message(d.msg || '网络错误');
					}
				})
			},
			//点击二级回复
			Reply: function() {
				Comm.showWindow();
				this.showReviews();
				if(model.fist == 1) {
					this.type = 1; //修改回复规则 针对回复进行回复
				} else {
					this.type = 2; //修改回复规则 针对回复进行回复
				}

				$('footer .top').show();
				$('footer>p').html('正在回复：' + customerName2);
			},
			shear: function(platform) {
				//分享资讯 -- 通用
				event.stopPropagation();
				var url = config.webroot + 'shareAskDetail.html?newsId=' + shearId + '&commentId=' + commentId;
				Comm.shareUrl({
					platform: platform,
					pic: config.webroot + "img/logo.png",
					title: shearTitle,
					desc: shearContent,
					url: url
				}, function(d) {
					if(d.code) {
						Comm.showWindow('')
						//Comm.message('分享成功！')
					}
				});
				//Comm.go('shareArticle.html')
			},
		}
	</script>
	<!-- 回复框处理 -->
	<script>
		var autoTextarea = function(elem, extra, maxHeight) {
			extra = extra || 0;
			var isFirefox = !!document.getBoxObjectFor || 'mozInnerScreenX' in window,
				isOpera = !!window.opera && !!window.opera.toString().indexOf('Opera'),
				addEvent = function(type, callback) {
					elem.addEventListener ?
						elem.addEventListener(type, callback, false) :
						elem.attachEvent('on' + type, callback);
				},
				getStyle = elem.currentStyle ? function(name) {
					var val = elem.currentStyle[name];

					if(name === 'height' && val.search(/px/i) !== 1) {
						var rect = elem.getBoundingClientRect();
						return rect.bottom - rect.top -
							parseFloat(getStyle('paddingTop')) -
							parseFloat(getStyle('paddingBottom')) + 'px';
					};

					return val;
				} : function(name) {
					return getComputedStyle(elem, null)[name];
				},
				minHeight = parseFloat(getStyle('height'));

			elem.style.resize = 'none';

			var change = function() {
				var scrollTop, height,
					padding = 0,
					style = elem.style;

				if(elem._length === elem.value.length) return;
				elem._length = elem.value.length;

				if(!isFirefox && !isOpera) {
					padding = parseInt(getStyle('paddingTop')) + parseInt(getStyle('paddingBottom'));
				};
				scrollTop = document.body.scrollTop || document.documentElement.scrollTop;

				elem.style.height = minHeight + 'px';
				if(elem.scrollHeight > minHeight) {
					if(maxHeight && elem.scrollHeight > maxHeight) {
						height = maxHeight - padding;
						style.overflowY = 'auto';
					} else {
						height = elem.scrollHeight - padding;
						style.overflowY = 'hidden';
					};
					style.height = height + extra + 'px';
					scrollTop += parseInt(style.height) - elem.currHeight;
					document.body.scrollTop = scrollTop;
					document.documentElement.scrollTop = scrollTop;
					elem.currHeight = parseInt(style.height);
				};
			};

			addEvent('propertychange', change);
			addEvent('input', change);
			addEvent('focus', change);
			change();
		};
		var text = document.getElementById("huifu");
		// autoTextarea(textarea); // 调用
	</script>

</html>