<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>添加关注</title>
    <meta content="width=device-width,initial-scale=1.0,user-scalable=no" name="viewport">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="format-detection" content="telephone=no,email=no,adress=no" />
    <link rel="stylesheet" href="css/g.css" />
    <link rel="stylesheet" href="css/comm.css" />
    <link rel="stylesheet" href="css/side.css" />
    <link rel="stylesheet" href="inc/mescroll/mescroll.min.css" />
    <link rel="stylesheet" href="inc/mescroll/swiper.min.css">
    <link rel="stylesheet" href="css/tpl.css" />

    <style>
        .searchBar {
            margin: 0 auto;
        }
        
        .searchBar input {
            width: 95%;
            padding-left: 30px;
            line-height: 30px;
            height: 30px;
            font-size: 14px;
            color: #8891A7;
            background-color: #F2F6F7;
            border-radius: 18px;
            background-image: url('img/search.png');
            background-repeat: no-repeat;
            background-size: 14px;
            background-position: 10px center;
            margin: 0 auto;
            margin-left: 2.5%;
        }
        
        .order-t {
            text-align: center;
            font-size: 12px;
        }
        
        .order-t-c {
            width: 50%;
            height: 100%;
            float: left;
            font-size: 15px;
            /*font-weight: bold;*/
            color: #888888;
        }
        
        .order-t-c-active {
            /*border-bottom: 2px solid #000000;*/
            position: relative;
            color: #098E75;
        }
        
        .order-t-c-active:after {
            content: '';
    position: absolute;
    left: 42%;
    bottom: auto;
    right: auto;
    height: 2px;
    width: 30px;
    background-color: #098E75;
        }
        
        .schoolMsg {
            border-bottom: 1px solid #f4f4f4;
            background-color: #fff;
            padding: 15px 15px 15px 5px;
        }
        .add-guan,.isJiaru{
        	background: inherit;
        }
        .caozuo{
        	margin-top: -1.5px;
        }
    </style>
</head>

<body>
    <!-- 头部 -->
    <header>
        <div class="navBar bottomShadow">
            <div class="navBackIcon" onclick="Comm.close()"></div>
            <div class="navItem hide" id="edit" onclick="model.addTo()" style="font-size: 26px;">+</div>
            <div class="navTitle">我的关注</div>
        </div>
        <div class="scrollx mescroll-touch-x">
            <div id="scrollxContent" class="scrollx-content">
                <div id="nav" class="order-t ovf bb1" style="border-bottom: 1px solid #f4f4f4;">
                    <!--<div class="order-t-c brp order-t-c-active" i='0'>大学</div>
						<div class="order-t-c brp" i='1'>专业</div>-->
                    <div class="order-t-c brp order-t-c-active" i='0'>用户</div>
                    <div class="order-t-c brp" i='1'>话题</div>
                </div>
            </div>
        </div>
    </header>
    <section>
        <!--轮播-->
        <div id="swiper" class="swiper-container">
            <div id="swiperWrapper" class="swiper-wrapper">
                <!--全部-->
                <div id="mescroll0" class="swiper-slide mescroll">
                    <div id="dataList0" class="data-list" style="background: #f4f4f4;">
                    </div>
                </div>
                <!--旗舰店-->
                <div id="mescroll1" class="swiper-slide mescroll">
                    <div id="dataList1" class="data-list" style="background: #f4f4f4;">
                    </div>
                </div>
                <!--优享店-->
                <!--<div id="mescroll2" class="swiper-slide mescroll">
						<div id="dataList2" class="data-list">
						</div>
					</div>-->
                <!--快取店-->
                <!--<div id="mescroll3" class="swiper-slide mescroll">
						<div id="dataList3" class="data-list">
						</div>
					</div>-->
            </div>
        </div>
    </section>
    <div class="mescroll-totop" onclick="Comm.showWindow('sinboxTemp2',true);">
        <img src="img/index/bj.png" width="45" />
    </div>
    <footer class="shared">

    </footer>
</body>
<script type="text/html" id="listTpl">
    <!-- 大学 -->
    <!--{{if($data.dataIndex==0)}} {{each $data v k}}
		<div class="schoolMsg" onclick="event.stopPropagation();Comm.go('University.html?schoolId={{v.schoolId}}')">
			<div class="heads">
				<div class="name-left fl">
					<img class="fl" style="border-radius: 50%;" src="{{OSS(v.schoolLogo)}}" onerror="this.src='img/my/mti.png';this.onerror=null;" width="40" height="40" />
					<div class="fl marl10">
						<p class="f14 bold wordW">{{v.schoolName}}</p>
						<p class="f12 c9e">{{v.cityName}}·粉丝 {{conunm(v.customerNum)}}</p>
					</div>
				</div>
				<div class="fr isAdd1 mart10">
					{{if(v.focus!=0)}}
					<div class="f14 isJiaru" onclick="event.stopPropagation(); model.removeSchool({{v.schoolId}},this)">取消关注</div>
					{{/if}} {{if(v.focus==0)}}
					<div class="f14 add-guan" onclick="event.stopPropagation();model.addSchool({{v.schoolId}},this)">关注</div>
					{{/if}}
				</div>
				<div class="clearfix"></div>
				<div style="padding-left: 40px;">
					{{each v.tagNames a b}}
					<div class="fl marl10 mart5 btn-biao f12">{{a}}</div>
					{{/each}}
					<div class="clearfix"></div>
				</div>
			</div>
		</div>
		{{/each}}
		{{/if}}-->
    <!-- 专业 -->
    <!--{{if($data.dataIndex==1)}} {{each $data v k}}
		<div class="schoolMsg" onclick="event.stopPropagation();Comm.go('major.html?majorId={{v.majorId}}')">
			<div class="heads">
				<div class="name-left fl" style="width: 75%;">
					<img class="fl" style="border-radius: 50%;" src="{{OSS(v.face)}}" onerror="this.src='img/my/mti.png';this.onerror=null;" width="40" height="40" />
					<div class="fl marl10" style="width: 70%;">
						<p class="f14 bold wordW">{{v.majorName}}</p>
						<p class="f12 c9e wordW">{{v.autograph}}</p>
						<p class="f12 c9e">粉丝{{conunm(v.customerNum)}} · 学校{{v.schoolNum}} </p>
					</div>
				</div>
				<div class="fr isAdd2 mart10">
					{{if(v.focus!=0)}}
					<div class="f14 isJiaru" onclick="event.stopPropagation();model.removeMajor({{v.majorId}},this)">取消关注</div>
					{{/if}} {{if(v.focus==0)}}
					<div class="f14 add-guan" onclick="event.stopPropagation();model.addMajor({{v.majorId}},this)">关注</div>
					{{/if}}
				</div>
				<div class="clearfix"></div>
			</div>
		</div>
		{{/each}} {{/if}}-->
    {{if($data.dataIndex==0)}} {{ include 'fenshiTpl' $data }} {{/if}} {{if($data.dataIndex==1)}} {{each $data v k}}
    <div class="schoolMsg" style="padding: 10px 10px 10px 0px;" onclick="Comm.go('talkDetail.html?topicId={{v.topicId}}')">
        <div class="heads">
            <div class="name-left fl" style="width: 75%; position: relative;">

                <div class="fl marl10" style="width: 100%;margin-left: 13px;">
                    <p class="f14 wordW"><img src="img/index/fwz.png" class="marb5" width="15" /> {{v.title}}</p>
                    <p class="f12 c9e mart10"> {{v.newsNumber}}篇· {{v.customerNumber}}关注</p>
                </div>
            </div>
            <!-- {{if($data.powerLimit==false)}} -->
            <div class="fr isAdd5 mart10">
                {{if(v.focus!=0)}}
                <div class="f14 isJiaru" onclick="model.removeTop({{v.topicId}},this);event.stopPropagation()" style="padding: 0; border: none;width: 52px;height: 30px;"><img style="margin-top: -1px;" src="img/isAdd.png" width="100%" height="30"/></div>
                {{/if}} {{if(v.focus==0)}}
                <div class="f14 add-guan" onclick="model.addTop({{v.topicId}},this);event.stopPropagation()" style="padding: 0; border: none;width: 52px;height: 30px;"><img style="margin-top: -1px;" src="img/add.png" width="100%" height="30"/></div>
                {{/if}}
            </div>
            <!-- {{/if}} -->
            <div class="clearfix"></div>
        </div>
    </div>
    {{/each}} {{/if}}
</script>

<!--  -->
<!--{{else if v.viplevel>0}}
             <div style="position: absolute; width:75px;height:75px;background:url(img/my/vippic.png);background-size:100% 100%;;">-->
 <!--{{if v.rahmenPic&&v.viplevel==0}}-->
<script type="text/html" id="fenshiTpl">
    {{each $data as v k}}
    <div class="fansItem" id="{{v.customerId}}" onclick="Comm.go('./personal.html?customerId={{v.customerId}}')">
        <div class="flex_wrap" style="align-items: center;width: 100%;">
        	<div class="fl" style="position: relative; width:75px;height:75px;">
           
            {{if v.rahmenPic}}
            <div style="position: absolute; width:75px;height:75px;background:url({{OSS(v.rahmenPic,'s')}});background-size:100% 100%;;">
            
            {{else}}
             <div style="position: absolute; width:75px;height:75px;">
            {{/if}}
            </div>
           
            <img src="{{OSS(v.face,'s')}}" onerror="this.src='img/my/mti.png';this.onerror=null;" style="border-radius: 50%;margin: 12px;" width="52" height="52" />
            
            {{if v.userType==5}}
                <img src="img/my/gf.png" width="15" height="15" style="position: absolute;bottom: 0px;right: 0;" />
                {{/if}}
            <!--{{if v.face}}
					<div class="fl" style="position: relative; width:50px;height:50px;background:url({{OSS(v.face,'s')}});background-size:cover;border-radius: 50%;">
                		{{else}}
                		<div class="fl" style="position: relative; width:50px;height:50px;background:url(img/my/mti.png);background-size:cover;border-radius: 50%;">
                		{{/if}}
                {{if v.viplevel>0}}
                <img src="img/my/vippic.png" width="50" height="50" /> 
                <img src="img/my/vipbiao.png" width="15" height="15" style="position: absolute;bottom: 0px;right: 0;" />
                {{else}}
                 {{if v.rahmenPic}}
                <img src="{{OSS(v.rahmenPic,'s')}}" width="50" height="50" />
                {{/if}}
                {{if v.userType==5}}
                <img src="img/my/gf.png" width="15" height="15" style="position: absolute;bottom: 0px;right: 0;" />
                {{/if}}
                {{/if}}-->
               
                
            </div>
            <div style="width: calc(100% - 115px);" class="marl10">
                <p class="wordW" style="color:#333;font-size:12px;font-weight: 700; ">{{v.customerName}}</p>
                <p class="wordW paddr10" style="color:#888888;font-size:12px;">{{if v.userType==5}}果仁官方{{else}}{{v.autograph||'这是一句生来就注定要被消灭的签名'}}{{/if}}</p>
                {{if v.customerId!=1&&v.customerId!=2}}
                <p class="f12 c9e">关注{{conunm(v.followNumber)}} · 粉丝{{conunm(v.fansNumber)}} · 获赞{{conunm(v.praiseNumber)}} </p>
            		{{/if}}
            </div>
            {{if myId!=v.customerId}} {{if v.customerId!=1&&v.customerId!=2}}
            <div class="caozuo">
                {{if(v.focus == 1&&v.isAdd==1)}}
                <i class="icon_quxiao" onclick="unfollow(this,{{v.customerId}});event.stopPropagation()"></i> {{/if}} {{if(v.focus == 1&&v.isAdd==0)}}
                <i class="icon_yguanzhu" onclick="unfollow(this,{{v.customerId}});event.stopPropagation()"></i> {{/if}} {{if(v.focus == 0)}}
                <i class="icon_guanzu" onclick="addFans(this,{{v.customerId}}); event.stopPropagation()"></i> {{/if}} {{/if}}
            </div>
            {{/if}}
        </div>
    </div>
    {{/each}}
</script>

<script type="text/javascript" src="inc/z.js"></script>
<script type="text/javascript" src="inc/g.js"></script>
<script type="text/javascript" src="inc/comm.js"></script>
<script type="text/javascript" src="inc/side.js"></script>
<script src="inc/mescroll/mescroll.min.js"></script>
<script src="inc/mescroll/swiper.min.js"></script>
<script src="inc/art-template.js"></script>
<script src="inc/refresh.js" charset="utf-8"></script>

<script>
    var customerId = app.getCid();
    var _customerId = Comm.query('customerId');
    var powerLimit = false; //权力限制 
    if (_customerId) {
        if (_customerId != customerId) {
            //customerId = _customerId;
            powerLimit = true; //开启限制
            $('.navTitle').html('他的关注');
            $('header .navItem').addClass('hide');
        } else {
            $('header .navItem').removeClass('hide');
        }
    } else {
        $('header .navItem').removeClass('hide');
    }

    function pageload() {
        mescrollRefreshFn({
            menuNumber: 2
        });
    }

    function pageresume() {
        //      var page = {
        //          num: 1,
        //          size: 10
        //      };
        //      getListData(page);
        if (Comm.db('noGuan')) {
            $('#' + Comm.db('noGuan')).remove();
            Comm.db('noGuan', '');
        }
    }
    var model = {
        //关注圈子
        add: function(groupsId, e) {
            AJAX.GET('/api/school/groups/addFocus?groupsId=' + groupsId + '&customerIds=' + customerId, function(a) {
                if (a && a.code == 1) {
                    $(e).parent().html('<div class="f14 fr add-guan"onclick="model.remove(' + groupsId + ',this)">退出</div>');
                } else {
                    Comm.message(a.msg);
                }
            })
        },
        remove: function(groupsId, e) {
            Comm.confirm('是否确认退出？', function(d) {
                if (d) {
                    AJAX.GET('/api/school/groups/cancelFocus?groupsId=' + groupsId + '&customerIds=' + customerId, function(a) {
                        if (a && a.code == 1) {

                            if (!a.data || a.data == '') {
                                $(e).parent().html('<div class="f14 fr add-guan" style="color:#fff;background:#098E75;" onclick="event.stopPropagation();model.add(' + groupsId + ',this)">加入</div>');
                            } else {
                                Comm.confirm('是否确认退出圈子，圈主权限将交给' + a.data.customerName, function(c) {
                                    if (c) {
                                        AJAX.GET('/api/school/groups/cancelFocusByLeader?groupsId=' + groupId + '&myGroupsId=' + a.data.myGroupsId, function(d) {
                                            if (d && d.code == 1) {
                                                $(e).parent().html('<div class="f14 fr add-guan" style="color:#fff;background:#098E75;" onclick="event.stopPropagation();model.add(' + groupsId + ',this)">加入</div>');
                                            } else {
                                                Comm.message(d.msg);
                                            }
                                        })
                                    }
                                })
                            }

                        } else {
                            Comm.message(a.msg);
                        }
                    })
                }
            })

        },
        //关注学校
        addSchool: function(id, e) {
            AJAX.GET('/api/school/addFocus?schoolIds=' + id + '&customerId=' + customerId, function(a) {
                if (a && a.code == 1) {
                    $(e).parent().html('<div class="f14 fr isJiaru"onclick="event.stopPropagation();model.removeSchool(' + id + ',this)">已关注</div>')
                } else {
                    Comm.message(a.msg);
                }
            })
        },
        removeSchool: function(id, e) {
            Comm.confirm('是否确认取消关注？', function(d) {
                if (d) {
                    AJAX.GET('/api/school/cancelFocus?schoolId=' + id + '&customerId=' + customerId, function(a) {
                        if (a && a.code == 1) {
                            $(e).parent().html('<div class="f14 fr add-guan" style="color:#fff;background:#098E75;" onclick="event.stopPropagation();model.addSchool(' + id + ',this)">关注</div>');
                        } else {
                            Comm.message(a.msg);
                        }
                    })
                }
            })

        },
        //关注专业
        addMajor: function(id, e) {
            AJAX.GET('/api/school/major/addFocus?majorId=' + id + '&customerId=' + customerId, function(a) {
                if (a && a.code == 1) {
                    $(e).parent().html('<div class="f14 fr isJiaru"onclick="event.stopPropagation();model.removeMajor(' + id + ',this)">已关注</div>');
                } else {
                    Comm.message(a.msg);
                }
            })
        },
        //取消专业关注
        removeMajor: function(id, e) {
            Comm.confirm('是否确认取消关注？', function(d) {
                if (d) {
                    AJAX.GET('/api/school/major/cancelFocus?majorId=' + id + '&customerId=' + customerId, function(a) {
                        if (a && a.code == 1) {
                            $(e).parent().html('<div class="f14 fr add-guan" style="color:#fff;background:#098E75;" onclick="event.stopPropagation();model.addMajor(' + id + ',this)">关注</div>');
                        } else {
                            Comm.message(a.msg);
                        }
                    })
                }
            })

        },
        //关注用户
        addCos: function(id, e) {
            AJAX.GET('/api/fans/addFans?fid=' + id + '&customerId=' + customerId, function(a) {
                if (a && a.code == 1) {
                    $(e).parent().html('<div class="f14 fr isJiaru"onclick="event.stopPropagation();model.removeCos(' + id + ',this)">已关注</div>');
                } else {
                    Comm.message(a.msg);
                }
            })
        },
        removeCos: function(id, e) {
            Comm.confirm('是否确认取消关注？', function(d) {
                if (d) {
                    AJAX.GET('/api/fans/unfollow?fid=' + id + '&customerId=' + customerId, function(a) {
                        if (a && a.code == 1) {
                            $(e).parent().html('<div class="f14 fr add-guan" onclick="event.stopPropagation();model.addCos(' + id + ',this)">关注</div>');
                        } else {
                            Comm.message(a.msg);
                        }
                    })
                }
            })

        },
        //关注话题
        addTop: function(id, e) {
            AJAX.GET('/api/topic/addFocus?topicId=' + id + '&customerId=' + customerId, function(a) {
                if (a && a.code == 1) {
                    $(e).parent().html('<div class="f14 fr isJiaru" onclick="event.stopPropagation();model.removeTop(' + id + ',this)" style="padding: 0; border: none;width: 52px;height: 30px;"><img src="img/isAdd.png" width="100%"/></div>');
                } else {
                    Comm.message(a.msg);
                }
            })
        },
        removeTop: function(id, e) {
            Comm.confirm('是否确认取消关注？', function(d) {
                if (d) {
                    AJAX.GET('/api/topic/cancelFocus?topicId=' + id + '&customerId=' + customerId, function(a) {
                        if (a && a.code == 1) {
                            $(e).parent().html('<div class="f14 fr  add-guan" onclick="event.stopPropagation();model.addTop(' + id + ',this)" style="padding: 0; border: none;width: 52px;height: 30px;"><img src="img/add.png" width="100%"/></div>');
                        } else {
                            Comm.message(a.msg);
                        }
                    })
                }
            })

        },
        addTo: function() {
            Comm.go('follow.html')
        }

    };
    //成为他的粉丝
    function addFans(e, fid) {
        var id = app.getCid();
        AJAX.POST('/api/fans/addFans', {
            customerId: id,
            fid: fid
        }, function(d) {
            if (d.code == 1) {
                if (d.data == 0) {
                    $(e).attr('class', 'icon_yguanzhu').attr('onclick', 'unfollow(this,' + fid + '); event.stopPropagation()')
                } else {
                    $(e).attr('class', 'icon_quxiao').attr('onclick', 'unfollow(this,' + fid + '); event.stopPropagation()')
                }
            } else {
                Comm.message(d.msg);
            }
        })
    }
    //取消关注
    function unfollow(e, fid) {

        Comm.confirm('是否确认取消关注？', function(a) {
            if (a) {
                var id = app.getCid();
                AJAX.POST('/api/fans/unfollow', {
                    customerId: id,
                    fid: fid
                }, function(d) {
                    if (d.code == 1) {

                        $(e).attr('class', 'icon_guanzu').attr('onclick', 'addFans(this,' + fid + ');event.stopPropagation()')
                    } else {
                        Comm.message(d.msg);
                    }
                })
            }
        })
    }

    /*设置列表数据
     * pageData 当前页的数据
     * dataIndex 数据属于哪个nav */
    function setListData(pageData, dataIndex) {
        var swiper = document.getElementById("swiper");
        var listDom = document.getElementById("dataList" + dataIndex),
            nowStr = "",
            listStr = "",
            name = "";
        if (pageData.length > 0) {
            pageData.dataIndex = dataIndex;
            if (dataIndex == 0) {
                for (var i = 0; i < pageData.length; i++) {
                    if (pageData[i].tagNames != '' && typeof(pageData[i].tagNames) == 'string') {
                        pageData[i].tagNames = pageData[i].tagNames.split(',');
                    }

                }
            }
            pageData.myId = app.getCid();
            pageData.hisId = Comm.query('customerId') ? Comm.query('customerId') : app.getCid();

            listStr = template('listTpl', pageData);
            if (pageData.curPage > 1) {
                listDom.innerHTML += listStr;
            } else {
                listDom.innerHTML = listStr;
            }

        }
Comm.scorllDel();
    }

    /*联网加载列表数据
     在您的实际项目中,请参考官方写法: http://www.mescroll.com/api.html#tagUpCallback
     请忽略getListDataFromNet的逻辑,这里仅仅是在本地模拟分页数据,本地演示用
     实际项目以您服务器接口返回的数据为准,无需本地处理分页.
     * */
    var htmlData = [];

    function getListDataFromNet(curNavIndex, pageNum, pageSize, successCallback, errorCallback) {
        var o = {};
        o.curpage = pageNum;
        o.pagesize = pageSize;
        //			if(curNavIndex == 0){
        //				o.followType = 1;
        //			}else if(curNavIndex==1){
        //				o.followType=2;
        //			}else 
        if (curNavIndex == 0) {
            o.followType = 3;
        } else if (curNavIndex == 1) {
            o.followType = 5;
        }
        o.keyword = '';
        if (_customerId) {
            o.customerId = _customerId
        } else {
            o.customerId = customerId
        }

        AJAX.POST('/api/customer/followList', o, function(a) {
            if (a && a.code == 1) {
                var r = a.data || [];
                r.powerLimit = powerLimit
                htmlData = r;
                totalSize = a.totalCount;
                htmlData.curPage = a.curPage;
                successCallback && successCallback(htmlData, totalSize);
            } else {
                Comm.message(a.msg);
                errorCallback && errorCallback();
            }
        });
    }
</script>

</html>